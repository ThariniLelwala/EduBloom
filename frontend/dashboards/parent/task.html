<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EduBloom - Student Tasks</title>

    <!-- Core CSS -->
    <link rel="stylesheet" href="../../css/style.css" />
    <link rel="stylesheet" href="../../css/cards.css" />
    <link rel="stylesheet" href="../../css/topbar.css" />
    <link rel="stylesheet" href="../../css/sidebar.css" />
    <link rel="stylesheet" href="../../css/dashboard/task.css" />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>

  <body>
    <div class="bg-image"></div>

    <div class="container">
      <!-- Sidebar -->
      <div id="sidebar-container"></div>

      <!-- Main content -->
      <main id="content">
        <div class="card welcome full">
          <div class="welcome-content">
            <h1 class="heading">
              <i class="fas fa-clipboard-list"></i>Student Tasks Management
            </h1>
            <div>"Monitor and manage your child's tasks and goals."</div>
          </div>
          <div class="welcome-image"></div>
        </div>

        <!-- ===== Summary Cards (Top Row) ===== -->
        <div class="summary-grid">
          <div class="card w1 small-card">
            <h4>To-Do Tasks</h4>
            <p id="todo-total">0</p>
          </div>

          <div class="card w1 small-card">
            <h4>Weekly Goals</h4>
            <p id="weekly-total">0</p>
          </div>

          <div class="card w1 small-card">
            <h4>Monthly Goals</h4>
            <p id="monthly-total">0</p>
          </div>
        </div>

        <!-- ===== Main Cards (Bottom Row) ===== -->
        <div class="card-grid">
          <!-- To-Do Card -->
          <div class="card w1 h2">
            <div class="card-header">
              <h3>To-Do</h3>
              <small id="todo-date"></small>
            </div>
            <ul id="todo-list"></ul>
            <button class="btn-secondary add-btn" data-type="todo">
              + Add Task
            </button>
          </div>

          <!-- Weekly Goals Card -->
          <div class="card w1 h2">
            <div class="card-header">
              <h3>Weekly Goals</h3>
              <small id="weekly-date"></small>
            </div>
            <ul id="weekly-list"></ul>
            <button class="btn-secondary add-btn" data-type="weekly">
              + Add Goal
            </button>
          </div>

          <!-- Monthly Goals Card -->
          <div class="card w1 h2">
            <div class="card-header">
              <h3>Monthly Goals</h3>
              <small id="monthly-date"></small>
            </div>
            <ul id="monthly-list"></ul>
            <button class="btn-secondary add-btn" data-type="monthly">
              + Add Goal
            </button>
          </div>
        </div>
      </main>
    </div>

    <!-- ===== Modal for Adding Task/Goal ===== -->
    <div id="task-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="modal-title">Add Item</h2>
          <button class="modal-close" id="modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <input type="text" id="task-input" placeholder="Enter task/goal..." />
        </div>
        <div class="modal-footer">
          <button class="btn-secondary" id="modal-cancel">Cancel</button>
          <button class="btn-primary" id="modal-save">Save</button>
        </div>
      </div>
    </div>

    <!-- ===== Modal for Editing Task ===== -->
    <div id="edit-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="edit-modal-title">Edit Task/Goal</h2>
          <button class="modal-close" id="edit-modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <input type="text" id="edit-input" placeholder="Edit text..." />
        </div>
        <div class="modal-footer">
          <button class="btn-secondary" id="edit-cancel">Cancel</button>
          <button class="btn-primary" id="edit-save">Save</button>
        </div>
      </div>
    </div>

    <!-- ===== Modal for Deleting Tasks ===== -->
    <div class="modal" id="delete-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Delete Task</h2>
          <button class="modal-close" id="delete-modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete this task/goal?</p>
        </div>
        <div class="modal-footer">
          <button class="btn-secondary" id="delete-cancel">Cancel</button>
          <button class="btn-primary" id="delete-confirm">Delete</button>
        </div>
      </div>
    </div>

    <!-- JS Files -->
    <script src="../../js/topbar.js"></script>
    <script src="../../js/sidebar.js"></script>
    <script src="../../js/bg-manager.js"></script>
    <script>
      // Parent Task Management Script
      let tasks = {
        todo: [],
        weekly: [],
        monthly: [],
      };

      let currentEditingIndex = -1;
      let currentEditingType = "";
      let currentAddingType = "";

      // Initialize on page load
      document.addEventListener("DOMContentLoaded", () => {
        loadTasks();
        setDates();
        renderTasks();
        setupEventListeners();
      });

      // Load tasks from localStorage
      function loadTasks() {
        const savedTasks = localStorage.getItem("parentTasks");
        if (savedTasks) {
          tasks = JSON.parse(savedTasks);
        } else {
          // Default sample tasks
          tasks = {
            todo: [
              {
                id: 1,
                text: "Complete Mathematics homework",
                completed: false,
              },
              { id: 2, text: "Read Chapter 5 of History", completed: false },
            ],
            weekly: [
              { id: 3, text: "Finish Science project", completed: false },
              {
                id: 4,
                text: "Practice piano for 30 minutes daily",
                completed: false,
              },
            ],
            monthly: [
              { id: 5, text: "Complete all assignments", completed: false },
              { id: 6, text: "Improve grades in Math", completed: false },
            ],
          };
          saveTasks();
        }
      }

      // Save tasks to localStorage
      function saveTasks() {
        localStorage.setItem("parentTasks", JSON.stringify(tasks));
      }

      // Render all tasks
      function renderTasks() {
        renderTaskList("todo");
        renderTaskList("weekly");
        renderTaskList("monthly");
        updateSummary();
      }

      // Render specific task list
      function renderTaskList(type) {
        const list = document.getElementById(`${type}-list`);
        list.innerHTML = "";

        tasks[type].forEach((task, index) => {
          const li = document.createElement("li");
          li.className = "task-item";

          // Add completed class if task is marked as completed
          if (task.completed) {
            li.classList.add("completed");
          }

          // Parent version - no checkbox, just text with edit/delete buttons
          li.innerHTML = `
            <span class="task-text">${task.text}</span>
            <div class="task-actions">
              <button class="edit-btn" onclick="editTask('${type}', ${index})" title="Edit task">
                <i class="fas fa-edit"></i>
              </button>
              <button class="delete-btn" onclick="deleteTask('${type}', ${index})" title="Delete task">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          `;
          list.appendChild(li);
        });

        // Update count
        const total = document.getElementById(`${type}-total`);
        if (total) {
          total.textContent = tasks[type].length;
        }
      }

      // Update summary counts
      function updateSummary() {
        document.getElementById("todo-total").textContent = tasks.todo.length;
        document.getElementById("weekly-total").textContent =
          tasks.weekly.length;
        document.getElementById("monthly-total").textContent =
          tasks.monthly.length;
      }

      // Set date information
      function setDates() {
        const today = new Date();
        const todayStr = today.toLocaleDateString("en-US", {
          month: "short",
          day: "numeric",
        });

        document.getElementById(
          "todo-date"
        ).textContent = `Today - ${todayStr}`;
        document.getElementById("weekly-date").textContent = "This week";
        document.getElementById("monthly-date").textContent = "This month";
      }

      // Setup event listeners
      function setupEventListeners() {
        // Add buttons
        document.querySelectorAll(".add-btn").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            currentAddingType = e.target.closest(".add-btn").dataset.type;
            openAddModal(currentAddingType);
          });
        });

        // Modal buttons
        document
          .getElementById("modal-close")
          .addEventListener("click", closeAddModal);
        document
          .getElementById("modal-cancel")
          .addEventListener("click", closeAddModal);
        document
          .getElementById("modal-save")
          .addEventListener("click", saveTask);

        document
          .getElementById("edit-modal-close")
          .addEventListener("click", closeEditModal);
        document
          .getElementById("edit-cancel")
          .addEventListener("click", closeEditModal);
        document
          .getElementById("edit-save")
          .addEventListener("click", saveEditedTask);

        document
          .getElementById("delete-modal-close")
          .addEventListener("click", closeDeleteModal);
        document
          .getElementById("delete-cancel")
          .addEventListener("click", closeDeleteModal);
        document
          .getElementById("delete-confirm")
          .addEventListener("click", confirmDelete);

        // Enter key support
        document
          .getElementById("task-input")
          .addEventListener("keypress", (e) => {
            if (e.key === "Enter") saveTask();
          });

        document
          .getElementById("edit-input")
          .addEventListener("keypress", (e) => {
            if (e.key === "Enter") saveEditedTask();
          });
      }

      // Open add modal
      function openAddModal(type) {
        const modal = document.getElementById("task-modal");
        const title = document.getElementById("modal-title");
        const typeLabel = type.charAt(0).toUpperCase() + type.slice(1);

        title.textContent = `Add ${typeLabel}`;
        document.getElementById("task-input").value = "";
        document.getElementById("task-input").focus();
        modal.classList.add("show");
      }

      // Close add modal
      function closeAddModal() {
        document.getElementById("task-modal").classList.remove("show");
        document.getElementById("task-input").value = "";
      }

      // Save new task
      function saveTask() {
        const input = document.getElementById("task-input");
        const text = input.value.trim();

        if (!text) {
          alert("Please enter a task/goal.");
          return;
        }

        const newTask = {
          id: Date.now(),
          text: text,
          completed: false,
        };

        tasks[currentAddingType].push(newTask);
        saveTasks();
        renderTasks();
        closeAddModal();
      }

      // Edit task
      function editTask(type, index) {
        currentEditingType = type;
        currentEditingIndex = index;
        const modal = document.getElementById("edit-modal");
        const input = document.getElementById("edit-input");

        input.value = tasks[type][index].text;
        input.focus();
        modal.classList.add("show");
      }

      // Close edit modal
      function closeEditModal() {
        document.getElementById("edit-modal").classList.remove("show");
        document.getElementById("edit-input").value = "";
      }

      // Save edited task
      function saveEditedTask() {
        const input = document.getElementById("edit-input");
        const text = input.value.trim();

        if (!text) {
          alert("Please enter a task/goal.");
          return;
        }

        tasks[currentEditingType][currentEditingIndex].text = text;
        saveTasks();
        renderTasks();
        closeEditModal();
      }

      // Delete task
      function deleteTask(type, index) {
        currentEditingType = type;
        currentEditingIndex = index;
        document.getElementById("delete-modal").classList.add("show");
      }

      // Close delete modal
      function closeDeleteModal() {
        document.getElementById("delete-modal").classList.remove("show");
      }

      // Confirm delete
      function confirmDelete() {
        tasks[currentEditingType].splice(currentEditingIndex, 1);
        saveTasks();
        renderTasks();
        closeDeleteModal();
      }
    </script>
  </body>
</html>
